<p><b>8.5. Исторические состояния</b></p>
<p>Как было отмечено ранее, формализм обычного конечного автомата не позволяет учитывать предысторию в процессе моделирования поведения систем и объектов. Однако функционирование целого ряда систем основано на возможности выхода из отдельного супер-состояния с последующим возвращением в это же состояние. При этом может оказаться необходимым учесть ту часть деятельности, которая была выполнена на момент выхода из этого состояния, чтобы не начинать ее выполнение сначала.</p>
<p>Историческое состояние (history state) применяется только в контексте составного состояния. Оно используется для запоминания того из последовательных под состояний, которое было текущим в момент выхода из составного состояния. При этом существует две разновидности исторического состояния: неглубокое (недавнее) и глубокое (давнее) (рис. 8.10).</p>
<p align="center"><img height="96" src="https://sun9-3.userapi.com/impg/-ufBt1vKIz2h759MowfYfqo9NrNNBMEuUIPdiA/fB0ZRIhtdeE.jpg?size=711x150&quality=95&sign=7beef0117207a7c8f66cfced73ffeba4&type=album" width="455"></p>
<p align="center"><b>Рис. 8.10. Графическое изображение недавнего (а) и давнего (б) исторического состояния</b></p>
<p>Неглубокое историческое состояние (shallow history state) обозначается в форме небольшой окружности, в которую помещена латинская буква &quot;Н&quot; (рис. 8.10, а).</p>
<p>Это состояние обладает следующей семантикой:</p>
<ol>
	<li>Оно является первым под состоянием в составном состоянии, и переход извне в рассматриваемое составное состояние должен вести непосредственно в данное историческое состояние.</li>
	<li>При первом попадании в неглубокое историческое состояние оно не хранит никакой истории (история пуста).</li>
</ol>
<p>Другими словами, при первом переходе в недавнее историческое состояние оно заменяет собой начальное состояние соответствующего конечного подавтомата.</p>
<p>Если в некоторый момент происходит выход из составного состояния (например, в случае наступления некоторого события), то рассматриваемое историческое состояние запоминает (сохраняет) то из под состояний, которое являлось текущим на момент выхода из данного составного состояния.</p>
<p>При этом неглубокое историческое состояние запоминает историю только того конечного подавтомата, к которому оно относится. Другими словами, этот тип псевдо- состояния способен запомнить историю только одного с ним уровня вложенности. Если сохраненное под состояние также является составным состоянием, а при выходе из исходного составного состояния необходимо запомнить некоторое под состояние второго уровня вложенности, то в этом случае следует воспользоваться более сильным псевдо-состоянием глубоким историческим состоянием.</p>
<p>Глубокое историческое состояние (deep history state) также обозначается в форме небольшой окружности, в которую помещена латинская буква &quot;Н&quot; с дополнительным символом &quot;*&quot; (звездочка) (рис. 8.10, б), и служит для за- поминания всех под состояний любого уровня вложенности для исходного составного состояния.</p>
<p>Простым примером, иллюстрирующим применение неглубокого исторического состояния, может служить логика работы почтовой программы- клиента. Предположим, при запуске этой программы мы находимся в состоянии написания нового сообщения, причем набран уже значительный фрагмент текста. Почтовая программа может быть сконфигурирована таким образом, что в фиксированные моменты (например каждые 30 минут) она проверяет наличие новых сообщений на сервере провайдера при удаленном доступе. МестопоDel + &gt; 注 20041D В этом случае составное состояние, работа редактора должно содержать вложенное историческое состояние, которое запоминает выполненную работу. После окончания дозвона и загрузки новой почты (в случае ее наличия) мы должны вернуться к сохраненному фрагменту нашего текста и продолжить работу с редактором. Рассмотренный ранее фрагмент диаграммы состояний почтовой программы- клиента (см. рис. 8.5) может быть дополнен с учетом указанного аспекта ee поведения</p>
<p><b>8.6. Сложные переходы</b></p>
<p>Рассмотренное выше понятие перехода является вполне достаточным для большинства типичных расчетно-вычислительных задач. Однако современные программные системы могут реализовывать очень сложную логику поведения отдельных своих компонентов. Может оказаться, что для адекватного представления Страница 226 из &nbsp;417 состояний семантика обычного перехода для них недостаточна. С этой целью в языке UML специфицированы дополнительные обозначения и свойства, которыми могут обладать отдельные переходы на диаграмме состояний.</p>
<p><b>8.6.1. Переходы между параллельными состояниями</b></p>
<p>В отдельных случаях возникает необходимость явно показать ситуацию, когда некоторый переход может иметь несколько исходных состояний или несколько целевых состояний. Такой переход получил специальное название <b>параллельный переход</b>. Введение в рассмотрение параллельных переходов может быть обусловлено необходимостью синхронизировать и/или разделить отдельные процессы управления на параллельные нити без спецификации дополнительной синхронизации в параллельных конечных подавтоматах.</p>
<p>Графически такой переход изображается вертикальной черточкой, аналогично обозначению перехода в известном формализме сетей Петри. Если параллельный переход имеет две или более входящие дуги (рис. 8.11, a), то его называют слиянием (join). Если же он имеет две или более исходящих из него дуг (рис. 8.11, б), то его называют разделением (fork). Текстовая строка спецификации параллельного перехода записывается рядом с черточкой и относится Страница подходящим исходящим дугам.</p>
<p align="center"><img height="212" src="https://sun9-80.userapi.com/impg/XuNxiRcglPqumQYuZ87ExJb-tpjt4wgIkVoc0w/rl6061Tq2bk.jpg?size=974x330&quality=95&sign=757e048bc1fc9a4186ab5949348de6f6&type=album" width="624"></p>
<p align="center"><b>Рис. 8.11. Графическое изображение параллельного перехода из параллельных под состояний (а) и параллельного перехода в параллельные под состояния (б)</b></p>
<p>Срабатывание параллельного перехода происходит следующим образом.</p>
<ul>
	<li>В первом случае переход-слияние срабатывает, если имеет место событие- триггер для всех исходных состояний этого перехода и выполнено (при его наличии) сторожевое условие. При срабатывании перехода-слияния одновременно покидаются все исходные под состояния перехода (под состояния 1 и 2) и происходит переход в целевое состояние. При этом каждое из исходных под состояний перехода должно принадлежать отдельному конечному под автомату, входящему в состав составного конечного автомата (процессу 1). МестопоDel Корание + &gt;</li>
	<li>Во втором случае происходит разделение составного конечного автомата на два конечных подавтомата, образующих параллельные ветви вложенных подпроцессов. При этом после срабатывания перехода-разделения моделируемая система или объект одновременно будет находиться во всех целевых под состояниях этого параллельного перехода (состояния 3 и 4). Далее процесс изменения состояний будет протекать согласно ранее рассмотренным правилам для составных состояний.</li>
</ul>
<p><b>8.6.2. Переходы между составными состояниями</b></p>
<p>Переход, стрелка которого соединена с границей некоторого составного состояния, обозначает переход в это составное состояние (переход в на рис. 8.12). Он эквивалентен переходу в начальное состояние каждого из конечных подав- томатов (возможно, единственному), входящих в состав данного супер состояния. Переход, выходящий из составного состояния ( переходы f и g на рис. 8.12), относится к каждому из вложенных под состояний. Это означает, что система или объект может покинуть данное составное состояние, находясь в любом из его под состояний. Для этого вполне достаточно наступления триггерного события и выполнения (в случае его наличия) сторожевого условия.</p>
<p align="center"><img height="214" src="https://sun9-59.userapi.com/impg/B-Cj0ia4GiYyRqaOAXZtkh5XUkinS5SgVqivIw/AQWBp8n815s.jpg?size=974x335&quality=95&sign=c9565ccf73f9a5aaba2ed542fde1f744&type=album" width="624"></p>
<p>&nbsp;</p>
<p>В этом случае изображают переход, который непосредственно выходит из вложенного под состояния и пересекает границу супер состояния (переход с на рис. 8.12). Аналогично, допускается изображение переходов, входящих извне составного состояния в отдельное вложенное состояние (переход а на рис. 8.12).</p>
<p><b>8.6.3. Синхронизирующие состояния</b></p>
<p>Как уже было отмечено, поведение параллельных конечных подавтоматов происходит независимо друг от друга, что позволяет, например, моделировать многозадачность Страница 228 из 4174 системах. Однако в отдельных ситуациях может возникнуть необходимость учесть в модели синхронизацию наступления отдельных событий и срабатывание соответствующих переходов. Для этой цели в языке UML имеется специальное псевдо состояние, которое называется синхронизирующим состоянием. Синхронизирующее состояние (synch state) обозначается небольшой окружностью, внутри которой помещен символ звездочки &quot;*&quot;. Оно используется совместно с переходом-слиянием или переходом-разделением для того, чтобы явно указать события в других конечных подавтоматах. Для иллюстрации использования синхронизирующих состояний рассмотрим упрощенную ситуацию с моделированием процесса постройки дома. Рассмотренные особенности синхронизации этих параллельных процессов учтены на соответствующей диаграмме состояний с помощью двух синхронизирующих состояний (рис. 8.13).</p>
<p><img height="322" src="https://sun9-8.userapi.com/impg/2d7vmb8_dFcQWsoUXK_3yoZHyZKItDagOkqtlQ/B16hFTmYks0.jpg?size=974x503&quality=95&sign=e3d0fd7ba011490b7c7e25c51e0e7421&type=album" width="623"></p>
<p>Рис. 8.13. Диаграмма состояний для примера со строительством дома</p>
<p>&nbsp;</p>
<p>В завершение этого подраздела рассмотрим диаграмму состояний, которая представляет собой пример моделирования поведения конкретной системы процесса функционирования телефонного аппарата (рис. 8.14). Этот пример иллюстрирует все основные особенности графической нотации, используемой при построении диаграммы состояний.</p>
<p>Кратко прокомментируем основные особенности этого примера. Данная диаграмма состояний представляет единственный конечный автомат с одним составным состоянием &ldquo;Дозвон и разговор с абонентом&rdquo;. Вне этого составного состояния имеется только одно состояние &ldquo;Ожидание&rdquo;, которое характеризует исправный и подключенный к телефонной сети телефонный аппарат. Переход в следующее состояние Страница 229, из 417 при понятии телефонной трубки.</p>
<p>Переход с атомарным действием подать тон-сигнал переводит аппарат в со- ставное состояние, а точнее в его начальное под состояние.</p>
<p><img height="571" src="https://sun9-68.userapi.com/impg/eysz0V-uRPAqeegOOZn6PDPcESStxZVyy5peqw/AX3JvTIm6os.jpg?size=974x892&quality=95&sign=e989a26ed5b32ad6dc26c56a224fc512&type=album" width="623"></p>
<p>Рис. 8.14. Диаграмма состояний процесса функционирования телефонного аппарата</p>
<p>Далее телефонный аппарат сразу переходит в под-состояние &ldquo;Тоновый сигнал&rdquo;. Доступны ENE &bull; Рекомендуемые При этом будет непрерывно издаваться тоновый сигнал до тех пор, пока не произойдет либо событие-триггер набор цифры (п), либо не истечет 15 секунд с момента поднятия трубки.</p>
<p>В первом случае аппарат перейдет в состояние &ldquo;Набор номера&rdquo;, а во втором в состояние &ldquo;Время ожидания истекло&rdquo;. Последняя ситуация может быть результатом сомнений по поводу &quot;звонить не звонить?&quot;, следствием чего могут быть гудки в трубке. При этом нам ничего не остается делать, как опустить ее на рычаг. МестопоDel Корание + &gt; При наборе номера выполняется событие-триггер набор цифры (п) со сторожевым условием номер неполный. Это означает, что если набранный телефонный номер не содержит необходимого количества цифр, то нам следует продолжать набор очередной цифры, находясь в состоянии Набор номера. Если же набранный номер полный, то можно перейти в состояние Соединение. В результате соединения может оказаться, что аппарат абонента занят(переход в состояние Занято). или свободен (переход в состояние Звонок у абонента). В первом случае можно повторить дозвон, предварительно опустив трубку на рычаг (выход из составного состояния).</p>
<p>Во втором случае телефон у вызываемого абонента будет звонить до тех пор, пока им не будет поднята трубка или не пройдет интервал времени, равный 30 сек. Очевидно, в последнем случае, в контексте рассматриваемой модели нам ничего не остается, как опустить трубку на рычаг. Если же вызываемый абонент поднял трубку, тем самым инициируется событие запрос ответа и происходит переход в состояние Разговор с выполнением действия разговор доступен. В состоянии Разговор моделируемая система может находиться как угодно долго. Для выхода из него необходимо выполнение триггерного перехода запрос на окончание разговора со стороны одного из абонентов и если разговаривают интеллигентные люди, то и взаимное согласие закончить разговор. Последнее моделируется с помощью сторожевого условия: подтверждение. Таким образом, после слов прощания и выполнения этого перехода разговор заканчивается, и мы опускаем трубку. При этом телефонный аппарат переходит в состояние Ожидание, в котором может находиться неопределенно долго.</p>
<p><b>8.7. Пример построения диаграммы состояний системы управления банкоматом</b></p>
<p>Продолжая построение модели сквозного примера модели системы управления банкоматом, построим диаграмму состояний для моделирования процесса функционирования банкомата как системы в целом. В этом случае в рамках разрабатываемой модели нам достаточно построить единственную диаграмму состояний, которая будет описывать реакцию банкомата на все события при реализации всех вариантов использования. Вариант диаграммы состояний системы управления банкоматом изображен на рис. 8.15.</p>
<p><img height="651" src="https://sun9-59.userapi.com/impg/RHST3grr1zSCxBqJmoOlxpk5StiO_18hzs7QWg/GqH38A7vdEM.jpg?size=974x1016&quality=95&sign=5029cb005e092cd6af512aa186c2cf1a&type=album" width="624"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Рис. 8.15. Диаграмма состояний системы управления банкоматом</p>
<p>Данная диаграмма содержит 12 состояний, два из которых (начальное и конечное) являются псевдо состояниями. Для простоты в качестве имен некоторых состояний используется спецификация деятельности, которая выполняется в процессе нахождения банкомата в соответствующих состояниях. Для подобных состояний (например, Проверка ПИН-кода, Получение наличных, Завершение транзакции) выходными переходами являются не триггерные переходы, для которых указаны только сторожевые условия.</p>
<p>Достоинством рассмотренной диаграммы состояний является возможность визуализировать на одном рабочем листе модели процесс поведения рассматриваемой системы в целом. Таким образом, полная модель системы может содержать либо единственную диаграмму состояний, описывающую реализации всех специфицированных вариантов использования (типичный ход событий и все исключения), либо несколько диаграмм состояний для отдельных ее подсистем (объектов). В последнем случае каждая из подсистем (объектов) должна иметь нетривиальное поведение, которое затрудняет его визуализацию на одной диаграмме состояний и служит веским аргументом построения нескольких диаграмм этого типа.</p>
<p><b>8.8. Заключительные рекомендации по построению диаграмм состояний</b></p>
<p>Основные особенности построения диаграмм состояний были рассмотрены при описании соответствующих модельных элементов. Однако некоторые моменты не нашли отражения, о чем необходимо сказать в заключение этой главы. По своему назначению диаграмма состояний не является обязательным представлением в модели и как бы &quot;присоединяется&quot; к тому элементу, который, по замыслу разработчиков, имеет нетривиальное поведение в течение своего жизненного цикла. Наличие у системы нескольких состояний, отличающихся от простой дихотомии &quot;исправен неисправен&quot;, &quot;активен неактивен&quot;, &quot;ожидание реакция на внешние действия&quot;, уже служит признаком необходимости построения диаграммы состояний. В качестве начального варианта диаграммы состояний, если нет очевидных соображений по поводу состояний объекта, можно воспользоваться подобными состояниями, рассматривая их как составные и уточняя их (детализируя их внутреннюю структуру) по мере рассмотрения логики поведения моделируемой системы или объекта. При выделении состояний и переходов следует помнить, что длительность срабатывания отдельных переходов должна быть существенно меньше, чем нахождение моделируемых элементов в соответствующих состояниях.</p>
<p>Каждое из состояний должно характеризоваться определенной устойчиво- стью во времени. Другими словами, из каждого состояния на диаграмме не может быть самопроизвольного перехода в какое бы то ни было другое со- стояние. Все переходы должны быть явно специфицированы, в противном случае построенная диаграмма состояний является либо неполной (неадекватной), либо ошибочной с точки зрения нотации языка UML (ill formed). При разработке диаграммы состояний нужно постоянно следить, чтобы объект в каждый момент находился только в единственном состоянии. Если это не так, то данное обстоятельство может быть следствием ошибки или не явным признаком наличия параллельности у поведения моделируемого объекта. В последнем случае следует явно специфицировать необходимое число конечных подавтоматов, вложив их в то составное состояние, которое характеризуется нарушением условия одновременности. Следует выполнять обязательную проверку того, чтобы никакие два перехода из одного состояния не могли сработать одновременно (требование отсутствия конфликтов у переходов). Наличие такого конфликта может служить признаком ошибки или неявной параллельности типа ветвления рассматриваемого процесса на два и более под конечных автомата. Если параллельность по замыслу разработчика отсутствует, то следует ввести дополнительные сторожевые условия либо изменить существующие, чтобы исключить конфликт переходов. При наличии параллельности следует заменить конфликтующие переходы одним параллельным переходом типа ветвления.</p>
<p>Использование исторических состояний оправдано в том случае, когда необходимо организовать обработку исключительных ситуаций (прерываний) без потери данных или выполненной работы. При этом применять исторические состояния, особенно глубокие, необходимо с известной долей осторожности. Нужно помнить, что каждый из конечных подавтоматов может иметь только одно историческое состояние. В противном случае возможны ошибки, особенно, когда подавтоматы изображаются на отдельных диаграммах состояний. МестопоDel + &gt; Корание И, наконец, следует отметить, что некоторые дополнительные конструкции конечных автоматов, такие как точки динамического выбора (dynamic choice points) или точки соединения (junction points), в книге не нашли отражения. Это сделано по той причине, что данные модельные элементы хотя и позволяют моделировать более сложные аспекты динамического управления по- ведением объекта, но не являются базовыми. Соответствующая информация содержится в оригинальной документации по языку UML. В заключение приводится сводка всех рассмотренных графических обозначений, которые могут быть использованы при построении диаграмм состояний (табл. 8.1).</p>
<p><b>Глава 9. Диаграмма деятельности</b></p>
<p>Для моделирования процессов изменения состояний систем и детализации особенностей их алгоритмических и процедурных реализаций традиционно применяются блок-схемы или структурные схемы алгоритмов. Они фокусируются на последовательностях выполнения действий, приводящих к желаемому результату. Примеры таких последовательностей можно найти в повседневной жизни, например, при звонке по телефону или приготовлении кофе.</p>
<p>С ростом сложности системы соблюдение строгой последовательности действий становится критически важным. Нарушения могут приводить к нежелательным последствиям, особенно в сложных системах, таких как авиационные или атомные технологии.</p>
<p>В языке UML для моделирования подобных процессов используются диаграммы деятельности, которые похожи на диаграммы состояний, но имеют специфическую графическую нотацию. Диаграммы деятельности в UML отличаются от диаграмм состояний тем, что представляют выполнение операций и действий, без учета сигналов событий. Каждое состояние соответствует отдельной операции, а переход происходит только после завершения предыдущей операции.</p>
<p>В контексте языка UML деятельность (activity) представляет собой некоторую совокупность отдельных вычислений, выполняемых автоматом. При этом отдельные элементарные вычисления могут приводить к некоторому результату или действию (action). На диаграмме деятельности отображается логика или последовательность перехода от одной деятельности к другой, при этом внимание фиксируется на результате деятельности.</p>
<p><b>Глава 9.1 Состояние действия</b></p>
<p>Состояние действия (action state) является специальным случаем состояния с некоторым входным действием и, по крайней мере, одним выходящим из состояния переходом. Этот переход неявно предполагает, что входное действие уже завершилось. Состояние действия не может иметь внутренних переходов, поскольку оно является элементарным.</p>
<p>Обычное использование состояния действия заключается в моделировании одного шага выполнения алгоритма (процедуры) или потока управления.</p>
<p><b>Часть II. Диаграммы концептуального, логического и физического моделирования</b></p>
<p>Графически состояние действия изображается фигурой, напоминающей прямоугольник со сферическими боковыми сторонами. Внутри этой фигуры записывается имя состояния действия в форме выражения действия (action-expression), которое должно быть уникальным в пределах одной диаграммы деятельности.</p>
<p>Действие может быть записано на естественном языке, псевдокоде или языке программирования без дополнительных ограничений. Рекомендуется использовать глаголы с пояснениями для имен простых действий. Формальные действия лучше записывать на языке реализации проекта. Сложные действия, состоящие из более простых, представляются состоянием под-деятельности (subactivity state), которое обозначается пиктограммой в правом нижнем углу символа состояния действия.</p>
<p>Каждая диаграмма деятельности должна содержать одно начальное и одно конечное состояние. Деятельность начинается в начальном состоянии и завершается в конечном. Диаграмму рекомендуется располагать так, чтобы действия шли сверху вниз: начальное состояние вверху, конечное внизу.</p>
<p><b>Глава 9.2 Переходы</b></p>
<p>При создании диаграммы деятельности используются только нетриггерные переходы, которые срабатывают сразу после завершения действия или деятельности. Переход приводит к следующему состоянию, как только завершится предыдущее.</p>
<p>Если из состояния действия выходит один переход, он не требует метки. Если переходов несколько, каждый должен иметь свое сторожевое условие в квадратных скобках, чтобы сработал только один из них.</p>
<p>Ветвление на диаграмме деятельности обозначается символом решения (decision) в виде ромба без текста. К ромбу подходит одна стрелка от состояния действия, после которого поток управления продолжается по одной из исключающих друг друга ветвей.</p>
<p><b>Часть II. Диаграммы концептуального, логического и физического моделирования</b></p>
<p>Как видно из данного рисунка, из соображений удобства допускается использовать вместо одного из сторожевых условий бинарного решения слово &quot;иначе&quot; (else).</p>
<p><b>9.3. Дорожки</b></p>
<p>Диаграммы деятельности применяются для моделирования бизнес-процессов, где каждое действие связывается с конкретным подразделением компании. В UML для этого используются &quot;дорожки&quot; (swimlanes), которые делят диаграмму на вертикальные секции, представляющие различные подразделения или сотрудников. Переходы между секциями отражают. Передачу ответственности между подразделениями (рис. 9.7).</p>
<p><b>Часть II.</b> <b>Диаграммы концептуального, логического и физического моделирования</b></p>
<p>Фрагмент диаграммы деятельности торговой компании, обслуживающей клиентов по телефону, включает три дорожки для отдела приема и оформления заказов, отдела продаж и склада, показывающие последовательность и ответственность каждого подразделения за выполнение рабочих действий (рис. 9.8).</p>
<p>Диаграмма показывает, что после принятия заказа отдел приема и оформления заказов разделяет работу на два потока: получение оплаты и подбор товара в отделе продаж. Затем товар выдается со склада. Подготовка товара начинается только после получения оплаты и выдачи со склада. После этого товар отправляется клиенту.</p>
<p>&nbsp;</p>



<style> 
	body 
	{ 
		margin-right: 370px;
		margin-left: 370px;
	}

    img {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

</style>